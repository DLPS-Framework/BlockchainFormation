  # Add sawtooth gpg key to apt
  echo "-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: SKS 1.1.6
Comment: Hostname: keyserver.ubuntu.com

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
0Wyzf4HF9sb/HCQ0usD3h6LC+8WNG0I=
=n7cg
-----END PGP PUBLIC KEY BLOCK-----" >> sawtooth.gpg

  sudo apt-key add sawtooth.gpg

  # Add stable sawtooth repository [Ubuntu 16.04]
  sudo add-apt-repository 'deb [arch=amd64] http://repo.sawtooth.me/ubuntu/bumper/stable xenial universe'
  sudo apt-get update

  # Install sawtooth
  sudo apt-get install -y sawtooth

  ## Install sawtooth devmode consensus engine
  #sudo apt-get install -y sawtooth-devmode-engine-rust

  # Install poet consensus engine
  sudo apt-get install -y python3-sawtooth-poet-engine

  # Install identity tp
  sudo apt-get install -y python3-sawtooth-identity

  # ====== Generate keys for sawtooth network ======

  # Generate user key for sawtooth
  sawtooth keygen

  # Generate root key for the validator
  sudo sawadm keygen

  # [Create the genesis block](https://sawtooth.hyperledger.org/docs/core/releases/latest/sysadmin_guide/creating_genesis_block.html)
  # ----------------------------------------------------------------------------

  # Become 'sawtooth' user
  #sudo -u sawtooth -s
  cd /tmp

  # Create a batch to initialize the Settings transaction family in the genesis block.
  su -c 'sawset genesis --key /etc/sawtooth/keys/validator.priv -o config-genesis.batch' -s /bin/sh sawtooth
  # This command authorizes this key (the validator key on this node) to change
  # Sawtooth settings. You must use the same key for the following commands in
  # this procedure. Also, any later commands to change on-chain Sawtooth
  # settings must specify this key.

  # Create a batch to initialize the PoET consensus settings. This command sets
  # the consensus algorithm to PoET simulator, and then applies the required
  # settings.
  ##sawset proposal create \
  su -c 'sawset proposal create -k /etc/sawtooth/keys/validator.priv \
  -o config.batch \
  sawtooth.consensus.algorithm.name=PoET \
  sawtooth.consensus.algorithm.version=0.1 \
  sawtooth.poet.report_public_key_pem="$(cat /etc/sawtooth/simulator_rk_pub.pem)" \
  sawtooth.poet.valid_enclave_measurements=$(poet enclave measurement) \
  sawtooth.poet.valid_enclave_basenames=$(poet enclave basename)' -s /bin/sh sawtooth

  # Create a batch to register the first validator with the Validator Registry.
  # Without this command, the validator would not be able to publish any blocks
  su -c 'poet registration create -k /etc/sawtooth/keys/validator.priv -o poet.batch' -s /bin/bash sawtooth

  # (Optional) Create a batch to configure optional PoET settings. This example
  # shows the default settings.
  su -c 'sawset proposal create -k /etc/sawtooth/keys/validator.priv \
  -o poet-settings.batch \
  sawtooth.poet.target_wait_time=5 \
  sawtooth.poet.initial_wait_time=25 \
  sawtooth.publisher.max_batches_per_block=100' -s /bin/bash sawtooth

  # Combine the previously created batches into a single genesis batch that will
  # be committed in the genesis block.
  su -c 'sawadm genesis config-genesis.batch config.batch poet.batch poet-settings.batch' -s /bin/bash sawtooth

  # Run sawtooth as a service
  sudo systemctl start sawtooth-rest-api.service
  sudo systemctl start sawtooth-poet-validator-registry-tp.service
  sudo systemctl start sawtooth-validator.service
  sudo systemctl start sawtooth-settings-tp.service
  sudo systemctl start sawtooth-intkey-tp-python.service
  sudo systemctl start sawtooth-identity-tp.service
  sudo systemctl start sawtooth-poet-engine.service

  ## Use the following command to start the validator on the first node.
  ## Substitute your actual values for the component and network bind strings,
  ## public endpoint string, and peer list, as described in Prerequisites.
  #sudo nohup sawtooth-validator -vv \
  #--bind component:tcp://127.0.0.1:4004 \
  #--bind network:tcp://127.0.0.1:8800 \
  #--endpoint tcp://127.0.0.1:8800 \
  #> validator.log 2>&1 &
  ##--peers {peer-list}
#
  ## Start REST API
  #sudo nohup sawtooth-rest-api -v > rest.log 2>&1 &
#
  ## Start Settings Transaction Processors
  #sudo nohup settings-tp -v > settings-tp.log 2>&1 &
#
  ## Start Intkey
  #sudo nohup intkey-tp-python -v > intkey-tp.log 2>&1 &
#
  ## Start XO Transaction Processor [ not included in v1.0]
  #sudo nohup xo-tp-python -v > xo.log 2>&1 &
#
  ## Start the poet tp
  #sudo nohup poet-validator-registry-tp -v > poet.log 2>&1 &

  # =======  Create success indicator at end of this script ==========
  touch /var/log/user_data_success.log
